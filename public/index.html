<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>ç§äººäº‘ç¬”è®°</title>
    <style>
        body { font-family: sans-serif; max-width: 600px; margin: 20px auto; padding: 20px; }
        .hidden { display: none; }
        .note-item { border: 1px solid #ddd; padding: 10px; margin: 10px 0; border-radius: 4px; display: flex; justify-content: space-between; }
        button { cursor: pointer; padding: 5px 10px; }
        .delete-btn { background: #ff4d4f; color: white; border: none; border-radius: 4px; }
        input { padding: 8px; width: 70%; }
    </style>
</head>
<body>

    <div id="login-page">
        <h1>ğŸ” è¯·ç™»å½•</h1>
        <input type="text" id="username" placeholder="è¾“å…¥ä½ çš„åå­— (æ¯”å¦‚: alice)">
        <button onclick="login()">è¿›å…¥ç¬”è®°</button>
    </div>

    <div id="note-page" class="hidden">
        <h1 id="welcome-msg">æˆ‘çš„ç¬”è®°</h1>
        <button onclick="logout()" style="float:right">é€€å‡º</button>
        
        <div style="margin: 20px 0;">
            <input type="text" id="new-note" placeholder="å†™ç‚¹ä»€ä¹ˆ...">
            <button onclick="addNote()">æ·»åŠ </button>
        </div>

        <div id="note-list">
            </div>
    </div>

    <script>
        // const API_URL = 'http://localhost:3000/api';  <-- åˆ æ‰æ—§çš„
const API_URL = '/api'; // <-- æ”¹æˆæ–°çš„ï¼ˆè‡ªåŠ¨ä½¿ç”¨å½“å‰ç½‘ç«™çš„åœ°å€ï¼‰
        let currentUser = null;

        // ç™»å½•
        async function login() {
            const username = document.getElementById('username').value;
            if(!username) return alert('åå­—ä¸èƒ½ä¸ºç©º');

            const res = await fetch(`${API_URL}/login`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ username })
            });
            
            const data = await res.json();
            currentUser = data.token; // æ‹¿åˆ°ä»¤ç‰Œ
            
            // åˆ‡æ¢ç•Œé¢
            document.getElementById('login-page').classList.add('hidden');
            document.getElementById('note-page').classList.remove('hidden');
            document.getElementById('welcome-msg').innerText = `${currentUser} çš„ç¬”è®°`;
            
            loadNotes(); // åŠ è½½ç¬”è®°
        }

        // åŠ è½½ç¬”è®°
        async function loadNotes() {
            const res = await fetch(`${API_URL}/notes`, {
                headers: { 'Authorization': currentUser } // äº®å‡ºä»¤ç‰Œ
            });
            const notes = await res.json();
            
            const list = document.getElementById('note-list');
            list.innerHTML = notes.map(note => `
                <div class="note-item">
                    <span>${note.content}</span>
                    <button class="delete-btn" onclick="deleteNote(${note.id})">åˆ é™¤</button>
                </div>
            `).join('');
        }

        // æ·»åŠ ç¬”è®°
        async function addNote() {
            const input = document.getElementById('new-note');
            const content = input.value;
            if(!content) return;

            await fetch(`${API_URL}/notes`, {
                method: 'POST',
                headers: { 
                    'Content-Type': 'application/json',
                    'Authorization': currentUser 
                },
                body: JSON.stringify({ content })
            });

            input.value = '';
            loadNotes(); // åˆ·æ–°åˆ—è¡¨
        }

        // åˆ é™¤ç¬”è®°
        async function deleteNote(id) {
            if(!confirm('ç¡®å®šåˆ é™¤å—ï¼Ÿ')) return;
            await fetch(`${API_URL}/notes/${id}`, {
                method: 'DELETE',
                headers: { 'Authorization': currentUser }
            });
            loadNotes();
        }

        function logout() {
            location.reload();
        }
    </script>
</body>
</html>